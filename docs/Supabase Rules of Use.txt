SUPABASE RULES OF USE

Governed Real Estate CRM

1ï¸âƒ£ PURPOSE OF THIS DOCUMENT

This document defines how Supabase may and may not be used in this product.

Supabase is:

âœ” Infrastructure

âœ” Persistence

âœ” Authentication (identity only)

âœ” Storage

âœ” Optional realtime transport

Supabase is NOT:

ğŸš« Business logic

ğŸš« UX decision-maker

ğŸš« Workflow engine

ğŸš« RBAC authority

ğŸš« Product brain

Any use outside these rules is a governance violation.

2ï¸âƒ£ AUTHENTICATION RULES (STRICT)
Allowed

Use Supabase Auth to authenticate users

Accept JWTs as proof of identity only

Use auth.uid() to map to internal users table

Forbidden

ğŸš« Storing roles in JWT claims

ğŸš« Trusting provider metadata for permissions

ğŸš« Branching UI logic based on token contents

Canonical Rule

The /me view is the sole authority for role and org.

3ï¸âƒ£ AUTHORIZATION & RLS RULES
What RLS IS For

Hard security boundaries

Org isolation

Ownership enforcement

Preventing accidental data leaks

What RLS IS NOT For

ğŸš« Workflow enforcement

ğŸš« Business rules

ğŸš« Conditional UX logic

ğŸš« Task logic

ğŸš« Timeline logic

RLS Complexity Rule

If a policy takes more than ~10 lines or requires comments to understand, it is too complex and must be redesigned.

4ï¸âƒ£ DATA ACCESS PATTERN (MANDATORY)
All Data Access Must Follow:
Frontend Screen
â†’ Domain Service
â†’ Supabase Query
â†’ RLS Safety Net


ğŸš« No direct Supabase calls from:

Components

Blocks

Sections

Utilities

5ï¸âƒ£ EVENT-FIRST IMMUTABILITY (NON-NEGOTIABLE)
Events Table Rules

Events are append-only

No updates

No deletes

No backfills

No â€œfixingâ€ data in place

Correct Way to Correct History

Create a new event that explains or supersedes the old one.

6ï¸âƒ£ TASKS ARE EVENTS (FOREVER)
Rules

There is no tasks table

There is no task_status

There is no is_overdue column

All task behavior is:

Derived

Deterministic

Computed at read-time

Any attempt to add a task table is an automatic rejection.

7ï¸âƒ£ SCHEMA CHANGE RULES
Allowed

Additive changes (new tables, new columns)

New indexes

New views

Forbidden

ğŸš« Renaming columns in-place

ğŸš« Changing meaning of existing fields

ğŸš« Removing columns without migration plan

ğŸš« â€œTemporaryâ€ schema hacks

Migration Rule

Every schema change requires a migration file and governance review.

8ï¸âƒ£ REALTIME RULES (IF / WHEN ENABLED)
Allowed

Broadcasting new events

Timeline live updates

Read-only subscriptions

Forbidden

ğŸš« Writing data via realtime

ğŸš« Business logic in realtime handlers

ğŸš« Realtime as a requirement for correctness

Realtime must be optional sugar, not a dependency.

9ï¸âƒ£ STORAGE RULES (DOCUMENTS)
Allowed

Transaction-scoped documents

Signed URLs

Server-mediated uploads

Forbidden

ğŸš« Public buckets

ğŸš« Direct client uploads without checks

ğŸš« Storing non-transaction artifacts

ğŸ”Ÿ PERFORMANCE & QUERY RULES
Required

Indexed created_at

Paginated timeline queries

Explicit filters (person_id, transaction_id)

Forbidden

ğŸš« â€œSELECT *â€ in production services

ğŸš« Unbounded timeline queries

ğŸš« Client-side security filtering

1ï¸âƒ£1ï¸âƒ£ ENVIRONMENT DISCIPLINE
Rules

Separate Supabase projects for:

local

staging

production

No shared keys

No prod data in dev

Violation = immediate incident.

1ï¸âƒ£2ï¸âƒ£ AI & AUTOMATION RULES
AI Agents

Must follow same rules as humans

May not create or alter RLS policies

May not modify migrations without approval

Generated SQL

Must be reviewed

Must be readable

Must align with contracts

1ï¸âƒ£3ï¸âƒ£ FAILURE MODES (AUTO-BLOCK)

The following are automatic governance failures:

ğŸš« Adding roles to JWT
ğŸš« Adding task tables
ğŸš« Encoding workflow in RLS
ğŸš« Bypassing /me
ğŸš« Direct Supabase calls from UI components
ğŸš« Mutating events

1ï¸âƒ£4ï¸âƒ£ ENFORCEMENT
Enforcement Mechanisms

PR checklist

AI UX Governance Agent

Migration review

Founder veto

No exceptions without:

Written justification

Sunset date

Explicit approval

ğŸ SUMMARY

These rules ensure:

Supabase stays an accelerator, not a liability

Your architecture remains intelligible

RBAC stays enforceable

UX remains coherent

AI agents remain safe to use

This is how you scale without losing control.